// Code generated by go-start. DO NOT EDIT.
// Repository: {{.ModelName}}Repository
// Source: {{.TableName}}

package repository

import (
	"context"
	"fmt"

	"gorm.io/gorm"
	"{{.ModulePath}}/internal/model"
)

// {{.ModelName}}Repository {{.ModelName}} 数据访问层
//
// 职责说明：
//   - 封装 {{.ModelName}} 的数据库操作
//   - 提供 CRUD 基础方法
//   - 提供复杂查询方法
//
// 设计原则：
//   - 每个 Repository 方法只负责一个数据操作
//   - 返回明确的错误信息
//   - 支持事务处理
type {{.ModelName}}Repository struct {
	db *gorm.DB
}

// New{{.ModelName}}Repository 创建 {{.ModelName}} Repository 实例
func New{{.ModelName}}Repository(db *gorm.DB) *{{.ModelName}}Repository {
	return &{{.ModelName}}Repository{db: db}
}

// Create 创建 {{.ModelName}}
func (r *{{.ModelName}}Repository) Create(ctx context.Context, {{ToLowerCamelCase .ModelName}} *model.{{.ModelName}}) error {
	return r.db.WithContext(ctx).Create({{ToLowerCamelCase .ModelName}}).Error
}

// GetByID 根据 ID 获取 {{.ModelName}}
func (r *{{.ModelName}}Repository) GetByID(ctx context.Context, id uint) (*model.{{.ModelName}}, error) {
	var {{ToLowerCamelCase .ModelName}} model.{{.ModelName}}
	err := r.db.WithContext(ctx).First(&{{ToLowerCamelCase .ModelName}}, id).Error
	return &{{ToLowerCamelCase .ModelName}}, err
}

// Update 更新 {{.ModelName}}
func (r *{{.ModelName}}Repository) Update(ctx context.Context, {{ToLowerCamelCase .ModelName}} *model.{{.ModelName}}) error {
	return r.db.WithContext(ctx).Save({{ToLowerCamelCase .ModelName}}).Error
}

// Delete 删除 {{.ModelName}}
func (r *{{.ModelName}}Repository) Delete(ctx context.Context, id uint) error {
	return r.db.WithContext(ctx).Delete(&model.{{.ModelName}}{}, id).Error
}

// List 获取 {{.ModelName}} 列表
func (r *{{.ModelName}}Repository) List(ctx context.Context, offset, limit int) ([]*model.{{.ModelName}}, int64, error) {
	var list []*model.{{.ModelName}}
	var total int64
	
	// 获取总数
	if err := r.db.WithContext(ctx).Model(&model.{{.ModelName}}{}).Count(&total).Error; err != nil {
		return nil, 0, err
	}
	
	// 获取列表
	err := r.db.WithContext(ctx).Offset(offset).Limit(limit).Find(&list).Error
	return list, total, err
}

// ============ 高级查询方法 ============
// 可以根据实际业务需求添加更多查询方法
// 例如：根据状态查询、根据时间范围查询等
