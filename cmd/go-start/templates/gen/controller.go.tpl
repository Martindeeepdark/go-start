// Code generated by go-start. DO NOT EDIT.
// Controller: {{.ModelName}}Controller
// Source: {{.TableName}}

package controller

import (
	"net/http"
	"strconv"

	"github.com/gin-gonic/gin"
	"{{.ModulePath}}/internal/model"
	"{{.ModulePath}}/internal/service"
	"{{.ModulePath}}/pkg/httpx/response"
)

// {{.ModelName}}Controller {{.ModelName}} 控制器
//
// 职责说明：
//   - 处理 {{.ModelName}} 相关的 HTTP 请求
//   - 参数验证和绑定
//   - 调用服务层处理业务逻辑
//   - 统一返回响应格式
//
// 设计原则：
//   - 只处理 HTTP 相关逻辑，不包含业务逻辑
//   - 使用 response 统一返回格式
//   - 参数校验失败返回明确的错误信息
type {{.ModelName}}Controller struct {
	service *service.{{.ModelName}}Service
}

// New{{.ModelName}}Controller 创建 {{.ModelName}} 控制器实例
func New{{.ModelName}}Controller(service *service.{{.ModelName}}Service) *{{.ModelName}}Controller {
	return &{{.ModelName}}Controller{
		service: service,
	}
}

// Create 创建 {{.ModelName}}
//
// @Summary 创建{{.ModelName}}
// @Description 创建一个新的{{.ModelName}}
// @Tags {{.ModelName}}
// @Accept json
// @Produce json
// @Param {{ToLowerCamelCase .ModelName}} body model.{{.ModelName}} true "{{.ModelName}}信息"
// @Success 200 {object} response.Response
// @Router /api/v1/{{ToLowerCamelCase .ModelName}}s [post]
func (c *{{.ModelName}}Controller) Create(ctx *gin.Context) {
	var {{ToLowerCamelCase .ModelName}} model.{{.ModelName}}
	if err := ctx.ShouldBindJSON(&{{ToLowerCamelCase .ModelName}}); err != nil {
		response.Error(ctx, http.StatusBadRequest, "参数错误: "+err.Error())
		return
	}

	if err := c.service.Create(ctx, &{{ToLowerCamelCase .ModelName}}); err != nil {
		response.Error(ctx, http.StatusInternalServerError, err.Error())
		return
	}

	response.Success(ctx, gin.H{"id": {{ToLowerCamelCase .ModelName}}.ID})
}

// GetByID 获取 {{.ModelName}} 详情
//
// @Summary 获取{{.ModelName}}详情
// @Description 根据 ID 获取{{.ModelName}}详细信息
// @Tags {{.ModelName}}
// @Accept json
// @Produce json
// @Param id path int true "{{.ModelName}} ID"
// @Success 200 {object} response.Response
// @Router /api/v1/{{ToLowerCamelCase .ModelName}}s/{id} [get]
func (c *{{.ModelName}}Controller) GetByID(ctx *gin.Context) {
	idStr := ctx.Param("id")
	id, err := strconv.ParseUint(idStr, 10, 32)
	if err != nil {
		response.Error(ctx, http.StatusBadRequest, "无效的ID")
		return
	}

	{{ToLowerCamelCase .ModelName}}, err := c.service.GetByID(ctx, uint(id))
	if err != nil {
		if err == service.Err{{.ModelName}}NotFound {
			response.Error(ctx, http.StatusNotFound, err.Error())
			return
		}
		response.Error(ctx, http.StatusInternalServerError, err.Error())
		return
	}

	response.Success(ctx, {{ToLowerCamelCase .ModelName}})
}

// Update 更新 {{.ModelName}}
//
// @Summary 更新{{.ModelName}}
// @Description 更新指定的{{.ModelName}}
// @Tags {{.ModelName}}
// @Accept json
// @Produce json
// @Param id path int true "{{.ModelName}} ID"
// @Param {{ToLowerCamelCase .ModelName}} body model.{{.ModelName}} true "{{.ModelName}}信息"
// @Success 200 {object} response.Response
// @Router /api/v1/{{ToLowerCamelCase .ModelName}}s/{id} [put]
func (c *{{.ModelName}}Controller) Update(ctx *gin.Context) {
	idStr := ctx.Param("id")
	id, err := strconv.ParseUint(idStr, 10, 32)
	if err != nil {
		response.Error(ctx, http.StatusBadRequest, "无效的ID")
		return
	}

	var {{ToLowerCamelCase .ModelName}} model.{{.ModelName}}
	if err := ctx.ShouldBindJSON(&{{ToLowerCamelCase .ModelName}}); err != nil {
		response.Error(ctx, http.StatusBadRequest, "参数错误: "+err.Error())
		return
	}

	{{ToLowerCamelCase .ModelName}}.ID = uint(id)
	if err := c.service.Update(ctx, &{{ToLowerCamelCase .ModelName}}); err != nil {
		response.Error(ctx, http.StatusInternalServerError, err.Error())
		return
	}

	response.Success(ctx, nil)
}

// Delete 删除 {{.ModelName}}
//
// @Summary 删除{{.ModelName}}
// @Description 删除指定的{{.ModelName}}
// @Tags {{.ModelName}}
// @Accept json
// @Produce json
// @Param id path int true "{{.ModelName}} ID"
// @Success 200 {object} response.Response
// @Router /api/v1/{{ToLowerCamelCase .ModelName}}s/{id} [delete]
func (c *{{.ModelName}}Controller) Delete(ctx *gin.Context) {
	idStr := ctx.Param("id")
	id, err := strconv.ParseUint(idStr, 10, 32)
	if err != nil {
		response.Error(ctx, http.StatusBadRequest, "无效的ID")
		return
	}

	if err := c.service.Delete(ctx, uint(id)); err != nil {
		response.Error(ctx, http.StatusInternalServerError, err.Error())
		return
	}

	response.Success(ctx, nil)
}

// List 获取 {{.ModelName}} 列表
//
// @Summary 获取{{.ModelName}}列表
// @Description 分页获取{{.ModelName}}列表
// @Tags {{.ModelName}}
// @Accept json
// @Produce json
// @Param page query int false "页码" default(1)
// @Param page_size query int false "每页数量" default(20)
// @Success 200 {object} response.Response
// @Router /api/v1/{{ToLowerCamelCase .ModelName}}s [get]
func (c *{{.ModelName}}Controller) List(ctx *gin.Context) {
	page, _ := strconv.Atoi(ctx.DefaultQuery("page", "1"))
	pageSize, _ := strconv.Atoi(ctx.DefaultQuery("page_size", "20"))

	{{ToLowerCamelCase .ModelName}}s, total, err := c.service.List(ctx, page, pageSize)
	if err != nil {
		response.Error(ctx, http.StatusInternalServerError, err.Error())
		return
	}

	response.Success(ctx, gin.H{
		"list":      {{ToLowerCamelCase .ModelName}}s,
		"total":     total,
		"page":      page,
		"page_size": pageSize,
	})
}
